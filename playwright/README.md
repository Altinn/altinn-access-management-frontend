# Get started with Playwright

Team Autorisasjon has adopted Playwright as key tool for automating end-to-end testing of Access-managment. This README.md is designed to guid you through the setup env and run tests against different test environment.

### Open Playwright and run tests

Run the below command to run Playwright tests with the environment in headless mode

```cmd
    yarn run env:AT22,
    yarn run env:AT23,
    yarn run env:AT24,
    yarn run env:TT02
```

#### Useful command line options

```
--timeout 10000: set general timeout for tests to override a long default if you want tests to fail quickly)
--repeat-each 20 --workers=1: (make sure a test is not flaky in combination with 1 worker to avoid test data complexity)
--debug: step by step mode
--grep "test name": match test name to only run specific test(s)
- full example: yarn run env:AT24 --grep "Delegate api to an organization by selecting from API" --timeout 10000 --repeat-each 20 --workers=1
```

Run the below command to run Playwright tests with the environment in UI mode

```cmd
    yarn run env:AT22 --ui
```

Run the below command to see playwright autogenerated report after passing test

```cmd
    yarn playwright show-report
```

## Test strategy

- Definition of E2E - frontend tests that go against the real backend. Run against a given test environment.
- Our main goal is to verify that we do not break any critical existing functionality unintentionally.

### How do we achieve this

- Want to run on a PR branch
- Cannot merge to main until the tests run green
- The owner of the PR (developer) fixes any failing e2e tests
- Should be able to override e2e test runs if it blocks a critical bug fix.
- Test data - should preferably avoid static test data.
- Good stability - the tests must build trust.
- Do cleanup via backend if possible.
- Easy to understand, should create a better understanding of the functionality in the solution and easy to read reports for test run results.
- Run the tests against only one of the at-environments(?). We should look at better definitions of the different AT environments (AT24)
  -- AT21 and AT22 = dev environments
  -- establish a better standard for what the different environments are used for

Test data - what do we need?

- Person who will log in, but must be able to specify whether it should be a private person, general manager, access manager (be able to specify the role of the person)
  - Also need org data for relevant organization
  - Need to know about existing roles, or specify roles for both people and organizations

#### Other things to consider

- Get reports for WCAG requirements
- Logging - need a separate application insights instance.
- Product owners - Ragnhild and Espen. Must decide what we can do here and how we prioritize.
